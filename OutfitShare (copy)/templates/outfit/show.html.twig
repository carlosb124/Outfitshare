{% extends 'base.html.twig' %}

{% block title %}{{ outfit.titulo }} - OutfitShare{% endblock %}

{% block body %}
<div class="max-w-6xl mx-auto px-4 py-6">
    {# Back Button #}
    <div class="mb-6">
        <a href="{{ path('app_feed') }}" class="inline-flex items-center text-gray-500 hover:text-dark-gray font-bold transition-colors">
            <i class="bi bi-arrow-left mr-2"></i> Back to Feed
        </a>
    </div>

    <div class="flex flex-col lg:flex-row gap-8 items-start">
        
        {# Left: Images (Collage Detail) #}
        <div class="w-full lg:w-2/3">
            <div class="bg-gray-100 rounded-3xl overflow-hidden shadow-inner p-1">
                <div class="grid grid-cols-2 gap-1 h-[500px] md:h-[600px]">
                    {% set count = outfit.prendas|length %}
                    {% if count == 0 %}
                         <div class="col-span-2 h-full flex items-center justify-center bg-white text-gray-300">
                            <div class="text-center">
                                <i class="bi bi-image text-4xl mb-2"></i>
                                <p>No items</p>
                            </div>
                        </div>
                    {% else %}
                        {# Display logic similar to card but expanded #}
                        {% for prenda in outfit.prendas %}
                             <div class="relative group overflow-hidden bg-white first:row-span-2 first:col-span-1 cursor-pointer">
                                <img src="{{ asset(prenda.imagen ? 'uploads/images/' ~ prenda.imagen : 'images/placeholder.png') }}" 
                                     class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" 
                                     alt="{{ prenda.nombre }}">
                                <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-end p-4">
                                    <div>
                                        <p class="text-white font-bold text-sm">{{ prenda.nombre }}</p>
                                        <p class="text-gray-300 text-xs">{{ prenda.marca }}</p>
                                    </div>
                                </div>
                             </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>

        {# Right: Info & Actions #}
        <div class="w-full lg:w-1/3 space-y-6 sticky top-24">
            <div class="bg-white rounded-3xl p-6 shadow-xl border border-gray-100">
                {# Header #}
                <div class="flex justify-between items-start mb-4">
                    <div>
                         <h1 class="text-2xl font-extrabold text-dark-gray leading-tight mb-1">{{ outfit.titulo }}</h1>
                         <div class="flex items-center gap-2 text-sm text-gray-500">
                            <a href="{{ path('app_profile_show', {'id': outfit.user.id}) }}" class="font-bold text-dark-gray hover:text-neon-lime transition-colors">
                                @{{ outfit.user.nickname|default(outfit.user.name) }}
                            </a>
                            <span>â€¢</span>
                            <span class="text-xs">{{ outfit.fechaPublicacion|date('d M Y') }}</span>
                         </div>
                    </div>
                </div>

                {# Description #}
                {% if outfit.descripcion %}
                    <p class="text-gray-600 mb-6 leading-relaxed">
                        {{ outfit.descripcion }}
                    </p>
                {% endif %}

                {# Social Stats Row #}
                <div class="flex items-center gap-4 py-4 border-t border-gray-100">
                    {% include 'like/_button.html.twig' with {'outfit': outfit} %}
                    {% include 'saved_outfit/_button.html.twig' with {'outfit': outfit} %}
                    
                    <button class="flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-gray-100 text-gray-500 hover:bg-gray-200 transition-all ml-auto">
                        <i class="bi bi-share-fill text-sm"></i>
                    </button>
                </div>

                {# Owner Permissions #}
                {% if app.user and app.user == outfit.user %}
                    <div class="grid grid-cols-2 gap-3 mt-4 pt-4 border-t border-gray-100">
                        <a href="{{ path('app_outfit_edit', {'id': outfit.id}) }}" class="flex items-center justify-center gap-2 py-2.5 rounded-xl border-2 border-gray-200 font-bold text-gray-600 hover:border-dark-gray hover:text-dark-gray transition-colors">
                            <i class="bi bi-pencil-square"></i> Edit
                        </a>
                        <form method="post" action="{{ path('app_outfit_delete', {'id': outfit.id}) }}" onsubmit="return confirm('Delete this outfit properly?');" class="block">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ outfit.id) }}">
                             <button class="w-full flex items-center justify-center gap-2 py-2.5 rounded-xl border-2 border-red-50 text-red-500 hover:bg-red-50 font-bold transition-colors">
                                <i class="bi bi-trash"></i> Delete
                            </button>
                        </form>
                    </div>
                {% endif %}
            </div>

            {# Comments Section #}
            <div class="bg-white rounded-3xl p-6 shadow-lg border border-gray-100">
                <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                    Comments <span class="bg-gray-100 text-gray-500 text-xs px-2 py-0.5 rounded-full">{{ outfit.comments|length }}</span>
                </h3>

                {# Comment List #}
                <div class="space-y-4 mb-6 max-h-60 overflow-y-auto custom-scrollbar pr-1">
                    {% for comment in outfit.comments %}
                        <div class="flex gap-3">
                            <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold text-gray-500 flex-shrink-0">
                                {{ comment.author.name|first|upper }}
                            </div>
                            <div>
                                <div class="bg-gray-50 rounded-2xl rounded-tl-none px-3 py-2">
                                    <p class="text-xs font-bold text-dark-gray mb-0.5">{{ comment.author.name }}</p>
                                    <p class="text-sm text-gray-700">{{ comment.content }}</p>
                                </div>
                                <span class="text-[10px] text-gray-300 ml-2">{{ comment.createdAt|date('H:i') }}</span>
                            </div>
                        </div>
                    {% else %}
                        <p class="text-center text-gray-400 text-sm py-4">No comments yet. Be the first!</p>
                    {% endfor %}
                </div>

                {# Add Comment Form #}
                {% if app.user %}
                    <form action="{{ path('app_comment_add', {'id': outfit.id}) }}" method="post" class="relative">
                        <input type="text" name="content" required
                               class="w-full bg-gray-50 border border-gray-200 rounded-full py-3 pl-4 pr-12 focus:ring-2 focus:ring-neon-lime focus:border-transparent text-sm"
                               placeholder="Add a comment...">
                        <button type="submit" class="absolute right-2 top-1.5 w-8 h-8 bg-dark-gray text-neon-lime rounded-full flex items-center justify-center hover:bg-black transition-colors shadow-sm">
                            <i class="bi bi-send-fill text-xs pl-0.5"></i>
                        </button>
                    </form>
                {% else %}
                    <div class="text-center bg-gray-50 p-3 rounded-xl border border-gray-100">
                        <p class="text-sm text-gray-500 mb-2">Login to join the conversation</p>
                        <a href="{{ path('app_login') }}" class="text-xs font-bold text-dark-gray underline">Login now</a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
