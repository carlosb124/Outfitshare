{% extends 'base.html.twig' %}

{% block title %}Ajustes - OutfitShare{% endblock %}

{% block body %}
<div style="max-width:580px;margin:40px auto;padding:0 16px;">
    <div class="os-card os-card--flat" style="padding:32px;">
        <div style="display:flex;align-items:center;gap:16px;margin-bottom:32px;">
            <a href="{{ path('app_profile_index') }}" class="settings-back">
                <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/>
                </svg>
            </a>
            <h1 class="os-title os-title--sm">Editar perfil</h1>
        </div>
        
        {{ form_start(form, {'attr': {'style': 'display:flex;flex-direction:column;gap:0;'}}) }}
            
            <div class="os-section">
                <h3 class="os-section__title">
                    <svg viewBox="0 0 24 24" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/>
                    </svg>
                    Imágenes del perfil
                </h3>
                
                <div class="settings-photos-grid">
                    <div x-data="{ photoPreview: '{{ app.user.profilePhoto|default(null) }}' }">
                        <span class="os-label" style="display:block;margin-bottom:8px;font-size:13px;color:var(--os-text-primary);">Foto de perfil</span>
                        <div class="settings-avatar-row">
                            <div class="settings-avatar" @click="$refs.profileInput.click()">
                                <template x-if="photoPreview"><img :src="photoPreview" alt="Foto"></template>
                                <template x-if="!photoPreview">
                                    <div class="settings-avatar-placeholder">
                                        <svg viewBox="0 0 24 24" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
                                        </svg>
                                    </div>
                                </template>
                                <div class="settings-avatar-overlay">
                                    <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                                        <circle cx="12" cy="13" r="4"/>
                                    </svg>
                                </div>
                                <div class="settings-avatar-badge">
                                    <svg viewBox="0 0 24 24" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>
                                    </svg>
                                </div>
                            </div>
                            <div>
                                <button type="button" @click="$refs.profileInput.click()" class="settings-upload-btn">Cambiar foto</button>
                                <p class="os-hint">JPG, PNG o WebP. Máx 5 MB.</p>
                            </div>
                        </div>
                        <div style="display:none;">
                            {{ form_widget(form.profilePhoto, {
                                'attr': {
                                    'x-ref': 'profileInput',
                                    '@change': 'const file = $el.files[0]; if(file){ const reader = new FileReader(); reader.onload = (e) => { photoPreview = e.target.result; }; reader.readAsDataURL(file); }'
                                }
                            }) }}
                        </div>
                        {{ form_errors(form.profilePhoto) }}
                    </div>

                    <div x-data="{ bannerPreview: '{{ app.user.bannerPhoto|default(null) }}' }">
                        <span class="os-label" style="display:block;margin-bottom:8px;font-size:13px;color:var(--os-text-primary);">Foto de portada</span>
                        <div class="settings-banner-zone" @click="$refs.bannerInput.click()">
                            <template x-if="bannerPreview"><img :src="bannerPreview" alt="Portada"></template>
                            <div class="settings-banner-zone-overlay">
                                <span class="settings-banner-zone-text">
                                    <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>
                                    </svg>
                                    Subir portada
                                </span>
                            </div>
                        </div>
                        <p class="os-hint" style="text-align:right;margin-top:8px;">Recomendado: 1200×400px</p>
                        <div style="display:none;">
                            {{ form_widget(form.bannerPhoto, {
                                'attr': {
                                    'x-ref': 'bannerInput',
                                    '@change': 'const file = $el.files[0]; if(file){ const reader = new FileReader(); reader.onload = (e) => { bannerPreview = e.target.result; }; reader.readAsDataURL(file); }'
                                }
                            }) }}
                        </div>
                        {{ form_errors(form.bannerPhoto) }}
                    </div>
                </div>
            </div>

            <div class="os-field">
                {{ form_label(form.name, 'Nombre completo') }}
                {{ form_widget(form.name) }}
                {{ form_errors(form.name) }}
            </div>

            <div class="os-field">
                {{ form_label(form.nickname, 'Nombre de usuario (@handle)') }}
                <div class="settings-nickname-wrap">
                    <span class="settings-nickname-at">@</span>
                    {{ form_widget(form.nickname) }}
                </div>
                {{ form_errors(form.nickname) }}
            </div>

            <div class="os-field">
                {{ form_label(form.biography, 'Bio') }}
                {{ form_widget(form.biography) }}
                <p class="os-hint">Cuéntanos sobre tu estilo y tus gustos.</p>
                {{ form_errors(form.biography) }}
            </div>

            <div class="os-field">
                {{ form_label(form.stylePreference, 'Preferencia de estilo') }}
                {{ form_widget(form.stylePreference) }}
                {{ form_errors(form.stylePreference) }}
            </div>

            <div class="os-section">
                {{ form_label(form.isPublic, 'Privacidad del perfil') }}
                <div style="margin-top:8px;display:flex;flex-direction:column;gap:8px;">
                    {% for child in form.isPublic %}
                        <div style="display:flex;align-items:center;">
                            {{ form_widget(child, {'attr': {'style': 'accent-color:var(--os-accent);width:16px;height:16px;'}}) }}
                            {{ form_label(child, null, {'label_attr': {'style': 'margin-left:10px;font-size:14px;color:var(--os-text-primary);'}}) }}
                        </div>
                    {% endfor %}
                </div>
            </div>

            <div class="os-section">
                <h3 class="os-section__title">
                    <svg viewBox="0 0 24 24" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                    Zonas de privacidad
                </h3>
                <div style="display:flex;flex-direction:column;gap:12px;">
                    <div style="display:flex;align-items:center;">
                        {{ form_widget(form.showLikesPublicly, {'attr': {'style': 'accent-color:var(--os-accent);width:18px;height:18px;'}}) }}
                        {{ form_label(form.showLikesPublicly, null, {'label_attr': {'style': 'margin-left:10px;font-size:14px;color:var(--os-text-primary);'}}) }}
                    </div>
                    <div style="display:flex;align-items:center;">
                        {{ form_widget(form.showSavedPublicly, {'attr': {'style': 'accent-color:var(--os-accent);width:18px;height:18px;'}}) }}
                        {{ form_label(form.showSavedPublicly, null, {'label_attr': {'style': 'margin-left:10px;font-size:14px;color:var(--os-text-primary);'}}) }}
                    </div>
                </div>
            </div>

            <div style="padding-top:8px;">
                <button type="submit" class="os-btn os-btn--primary os-btn--block">Guardar cambios</button>
            </div>
            
        {{ form_end(form) }}
    </div>
</div>
{% endblock %}
