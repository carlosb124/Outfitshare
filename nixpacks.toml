[variables]
    PHP_EXTENSIONS = "pdo, pdo_mysql, iconv, mbstring, intl, gd"
    APP_ENV = "prod"
    APP_DEBUG = "0"
    COMPOSER_ALLOW_SUPERUSER = "1"
    NIXPACKS_PHP_ROOT_DIR = "/app/public"

[phases.setup]
    nixPkgs = ["...", "php83Extensions.gd"]

[phases.build]
    dependsOn = ['install']
    cmds = [
        'php bin/console tailwind:build --minify',
        'php bin/console asset-map:compile',
        'mkdir -p public/uploads/images',
        'chmod +x run-app.sh'
    ]

[start]
    cmd = 'sh run-app.sh'